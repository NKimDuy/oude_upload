<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
	
		<!-- javascript/jquery -->
		<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
		<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
		<!--------------------------------------------------------------------------------->
		
		<!-- bootstrap 4 -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
		<!---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
		
		<!-- datatable -->
		
		<!---->
		
		<style>
			.error {
				color:red;
				border: 1px solid transparent;
				padding: 0.3em;
			}
		</style>
		
	</head>
	<body>
		<div class="container">
			<button id="btnAdd">Add Record</button>
			<div class="row">
				<select id="tableName">
					<option value="test1">test1</option>
				</select>
			</div>
			
			<table id="example"></table>
			<div id="dialogDelete" title="Delete Row">
				<p id="mssvDelete"></p>
			</div>
			<div id="dialog" style="display:none;">
				<p class="error">các trường có dấu ( * ) là bắt buộc.</p>
				<form>
					<fieldset>
						<div class="form-group">
						
							<label for="txtStt">STT</label>
							<input class="form-control" type="text" name="stt" id="txtStt" />
							
							<label for="txtStt">MSSV</label>
							<input class="form-control" type="text" name="mssv" id="txtMssv" />
							
							<label for="txtMadvlk">Mã đơn vị liên kết</label>
							<input class="form-control" type="text" name="maDvlk" id="txtMadvlk" />
							
							<label for="txtTendvlk">Tên đơn vị liên kết</label>
							<input class="form-control" type="text" name="tenDvlk" id="txtTendvlk" />
							
							<label for="txtHo">Họ</label>
							<input class="form-control" type="text" name="ho" id="txtHo" />
							
							<label for="txtTen">Tên</label>
							<input class="form-control" type="text" name="ten" id="txtTen" />
							
							<label for="txtNgaySinh">Ngày sinh</label>
							<input class="form-control" type="text" name="ngaySinh" id="txtNgaySinh" />
							
							<label for="txtNoiSinh">Nơi Sinh</label>
							<input class="form-control" type="text" name="noiSinh" id="txtNoiSinh" />
							
							
							<label for="txtGioiTinh">Giới tính</label>
							<select class="custom-select" id="txtGioiTinh">
								<option value="Nam">Nam</option>
								<option value="Nữ">Nữ</option>
							</select>
							
							<label for="txtDanToc">Dân tộc</label>
							<input class="form-control" type="text" name="danToc" id="txtDanToc" />
							
							<label for="txtQuocTich">Quốc tịch</label>
							<input class="form-control" type="text" name="quocTich" id="txtQuocTich" />
							
							<label for="txtNganhDaoTao">Ngành đào tạo</label>
							<input class="form-control" type="text" name="nganhDaoTao" id="txtNganhDaoTao" />
							
							<label for="txtGiayKhaiSinh">Giấy khai sinh</label>
							<input class="form-control" type="text" name="giayKhaiSinh" id="txtGiayKhaiSinh" />
							
							<label for="txtBangCap">Bằng cấp</label>
							<input class="form-control" type="text" name="bangCap" id="txtBangCap" />
							
							
							<label for="txtHinh">Hình</label>
							<select class="custom-select" id="txtHinh">
								<option value="HỢP LỆ">HỢP LỆ</option>
								<option value="BỔ SUNG">BỔ SUNG</option>
							</select>
							
							<label for="txtPdkxcb">Phiếu đăng kí xét cấp bằng</label>
							<select class="custom-select" id="txtPdkxcb">
								<option value="HỢP LỆ">HỢP LỆ</option>
								<option value="BỔ SUNG">BỔ SUNG</option>
							</select>
							
							<label for="txtCtdt">Chương trình đào tạo</label>
							<select class="custom-select" id="txtCtdt">
								<option value="HOÀN THÀNH">HOÀN THÀNH</option>
								<option value="CHƯA HOÀN THÀNH">CHƯA HOÀN THÀNH</option>
							</select>
							
							<label for="txtHtdt">Hình thức đào tạo</label>
							<input class="form-control" type="text" name="htdt" id="txtHtdt" />
							
							<label for="txtDiem">Điểm</label>
							<input class="form-control" type="text" name="diem" id="txtDiem" />
							
							<label for="txtXepLoai">Xếp loại</label>
							<input class="form-control" type="text" name="xepLoai" id="txtXepLoai" />
							
							<label for="txtDktn">Điều kiện tốt nghiệp</label>
							<select class="custom-select" id="txtDktn">
								<option value="Đủ điều kiện">Đủ điều kiện</option>
								<option value="Chưa đủ điều kiện">Chưa đủ điều kiện</option>
							</select>
							
							<label for="txtHokd">Họ không dấu</label>
							<input class="form-control" type="text" name="hoKd" id="txtHoKd" />
							
							<label for="txtTenkd">Tên không dấu</label>
							<input class="form-control" type="text" name="tenKd" id="txtTenKd" />
							
							<label for="txtHoTenKd">Họ và tên không dấu</label>
							<input class="form-control" type="text" name="hoTenKd" id="txtHoTenKd" />
							
							<label for="txtHocKi">Học kì</label>
							<input class="form-control" type="text" name="hocKi" id="txtHocKi" />
							
							<label for="txtCthk">Chi tiết học kì</label>
							<input class="form-control" type="text" name="cthk" id="txtCthk" />
							
							<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
						</div>
					</fieldset>
				</form>
			</div>
		</div>
		
	</body>
	<script>
		
		function updateTips(text) {
			$(".error")
			.text(text)
			.addClass("ui-state-highlight");
			setTimeout(function() {
				element.removeClass("ui-state-highlight", 1500);
			}, 500 );
		}
		
		function checkLength(element, column, min, max) {
			if ( element.val().length > max || element.val().length < min ) {
				element.addClass("ui-state-error");
				updateTips("Length of " + column + " must be between " +
				min + " and " + max + ".");
				return false;
			} else {
				return true;
			}
		}
		
		function checkRegexp( element, regexp, errorMessage ) {
			if ( !( regexp.test(element.val()))) {
				element.addClass("ui-state-error");
				updateTips(errorMessage);
				return false;
			} else {
				return true;
			}
		}
	
		function regexpForCreateUpdate(strUrl, dialogId) {
			var data = [];
			data.push($("#txtStt").val(),
						$("#txtMadvlk").val(),
						$("#txtTendvlk").val(),
						$("#txtMssv").val(),
						$("#txtHo").val(),
						$("#txtTen").val(),
						$("#txtNgaySinh").val(),
						$("#txtNoiSinh").val(),
						$("#txtGioiTinh").val(),
						$("#txtDanToc").val(),
						$("#txtQuocTich").val(),
						$("#txtNganhDaoTao").val(),
						$("#txtGiayKhaiSinh").val(),
						$("#txtBangCap").val(),
						$("#txtHinh").val(),
						$("#txtPdkxcb").val(),
						$("#txtCtdt").val(),
						$("#txtHtdt").val(),
						$("#txtDiem").val(),
						$("#txtXepLoai").val(),
						$("#txtDktn").val(),
						$("#txtHoKd").val(),
						$("#txtTenKd").val(),
						$("#txtHoTenKd").val(),
						$("#txtHocKi").val(),
						$("#txtCthk").val());
			$.ajax({
				//url: "./UpdateTableAjax.php",
				url: strUrl,
				method: 'post',
				data: {
					"row": data,
					"table_name": $("#tableName").val()
				},
				dataType: "json",
				'success': function(result) {
					//alert(strUrl);
					alert(result);
					
				},
				'complete': function(){
					alert(strUrl);
					$(dialogId).dialog( "close" );
					loadTable();
				}
			});
			
			//$( this ).dialog( "close" );
			//location.reload();
		}
	
		function createRow() {
			$("#mssv").attr("disabled", false);
			$("#dialog").attr("title", "Create Row"), $("#txtStt").attr("disabled",true);
			$.post({
				url: "./GetSttDataAjax.php",
				data: {
					"table_name": $("#tableName").val()
				},
				dataType: "json",
				success: result => {
					
					$("#txtStt").val(parseInt(result["MAX(stt)"]) + 1), $("#txtMadvlk").val(""), $("#txtTendvlk").val(""),
					
					$("#txtMssv").val(""), $("#txtHo").val(""), $("#txtTen").val(""),
					
					$("#txtNgaySinh").val(""), $("#txtNoiSinh").val(""),
					
					$("#txtGioiTinh").val(""), $("#txtDanToc").val(""),
					
					$("#txtQuocTich").val(""), $("#txtNganhDaoTao").val(""),
					
					$("#txtGiayKhaiSinh").val(""), $("#txtBangCap").val(""),
					
					$("#txtHinh").val(""), $("#txtPdkxcb").val(""),
					
					$("#txtCtdt").val(""), $("#txtHtdt").val(""),
					
					$("#txtDiem").val(""), $("#txtXepLoai").val(""),
					
					$("#txtDktn").val(""), $("#txtHoKd").val(""),
					
					$("#txtTenKd").val(""), $("#txtHoTenKd").val(""),
					
					$("#txtHocKi").val(""), $("#txtCthk").val("");
					
					$("#dialog").dialog({
						height: 'auto',
						width: 1000,
						modal:true,
						fluid: true,
						my: "center",
						at: "center",
						buttons: {
							"Add": function() {
								regexpForCreateUpdate("./AddDataTableAjax.php", "#dialog");
								
							},
							"Cancel": function() {
								$( this ).dialog( "close" );
							}
						},
						close: function() {
							$( this ).dialog( "destroy" );
						}
					});
					
				}
				
			});
		}
	
		function updateRow(object) {
			$("#dialog").attr("title", "Update Row");
		
			$("#txtStt").attr("disabled",true), $("#txtMssv").attr("disabled",true);
			
			$("#txtStt").val(object.stt), $("#txtMadvlk").val(object.ma_dvlk), $("#txtTendvlk").val(object.ten_dvlk),
			
			$("#txtMssv").val(object.mssv), $("#txtHo").val(object.ho), $("#txtTen").val(object.ten),
			
			$("#txtNgaySinh").val(object.ngay_sinh), $("#txtNoiSinh").val(object.noi_sinh),
			
			$("#txtGioiTinh").val(object.gioi_tinh), $("#txtDanToc").val(object.dan_toc),
			
			$("#txtQuocTich").val(object.quoc_tich), $("#txtNganhDaoTao").val(object.nganh_dt),
			
			$("#txtGiayKhaiSinh").val(object.giay_ks), $("#txtBangCap").val(object.bang_cap),
			
			$("#txtHinh").val(object.hinh), $("#txtPdkxcb").val(object.phieu_dkxcb),
			
			$("#txtCtdt").val(object.ct_dt), $("#txtHtdt").val(object.hinh_thuc_dt),
			
			$("#txtDiem").val(object.diem), $("#txtXepLoai").val(object.xep_loai),
			
			$("#txtDktn").val(object.dk_tn), $("#txtHoKd").val(object.ho_temp),
			
			$("#txtTenKd").val(object.ten_temp), $("#txtHoTenKd").val(object.temp),
			
			$("#txtHocKi").val(object.hk), $("#txtCthk").val(object.chi_tiet_hk);
				
				
			$("#dialog").dialog({
				height: 'auto',
				width: 1000,
				modal:true,
				fluid: true,
				my: "center",
				at: "center",
				buttons: {
					"Update": function(){
						regexpForCreateUpdate("./UpdateTableAjax.php", "#dialog");
					},
					"Cancel": function() {
						$( this ).dialog( "close" );
					}
				},
				close: function() {
					$( this ).dialog( "destroy" );
				}
			});
			
		}
		
		
		
		function deleteRow(mssv) {
			$("#mssvDelete").text("delete: " + mssv);
			$("#dialogDelete").dialog({
				height: 'auto',
				width: 'auto',
				modal:true,
				fluid: true,
				my: "center",
				at: "center",
				buttons: {
					"Do you wanna delete ?": function() {
						
						$.post({
							url: "./DeleteDataTableAjax.php",
							data: {
								"table_name": $("#tableName").val(),
								"mssv": mssv
							},
							dataType: "json",
							success: function() {
								
							}
						});
						$( this ).dialog( "close" );
						location.reload();
					},
					"Cancel": function() {
						$( this ).dialog( "close" );
					}
				},
				close: function() {
					$( this ).dialog( "destroy" );
				}
			});
		}
	
	
		function loadTable() {
			// tạo các cột
			var addThToTable = "<tr>";
			$.get({
				url:"./GetTitleTableAjax.php",
				data: {
					"table_name": $("#tableName").val()
				},
				dataType:"json",
				success: function(result) {
					addThToTable = "<tr><th></th><th></th>";
					result.forEach(item => {
						
						addThToTable += "<th>" + item + "</th>";
						
					});
					addThToTable += "</tr>";
						$("#example").append(addThToTable);
					
					
				},
				// tạo các dòng
				complete: function() {
					var addTdToTable = "";
					$.get({
						url:"./GetDataTableAjax.php",
						data: {
							"table_name": $("#tableName").val()
						},
						dataType:"json",
						success: function(result) {
							result.forEach(item => {
								
								
								addTdToTable = "<tr>";
								addTdToTable += "<td><a id = '" + item.mssv + "' href = '#'>Update</a></td>"
											 +"<td><a href =" + "javascript:deleteRow('" + item.mssv + "');>Delete</a></td>"
											 + "<td>" + item.stt + "</td>"
											 +"<td>" + item.ma_dvlk + "</td>"
											 +"<td>" + item.ten_dvlk + "</td>"
											 +"<td>" + item.mssv + "</td>"
											 +"<td>" + item.ho + "</td>"
											 +"<td>" + item.ten + "</td>"
											 +"<td>" + item.ngay_sinh + "</td>"
											 +"<td>" + item.noi_sinh + "</td>"
											 +"<td>" + item.gioi_tinh + "</td>"
											 +"<td>" + item.dan_toc + "</td>"
											 +"<td>" + item.quoc_tich + "</td>"
											 +"<td>" + item.nganh_dt + "</td>"
											 +"<td>" + item.giay_ks + "</td>"
											 +"<td>" + item.bang_cap + "</td>"
											 +"<td>" + item.hinh + "</td>"
											 +"<td>" + item.phieu_dkxcb + "</td>"
											 +"<td>" + item.ct_dt + "</td>"
											 +"<td>" + item.hinh_thuc_dt + "</td>"
											 +"<td>" + item.diem + "</td>"
											 +"<td>" + item.xep_loai + "</td>"
											 +"<td>" + item.dk_tn + "</td>"
											 +"<td>" + item.ho_temp + "</td>"
											 +"<td>" + item.ten_temp + "</td>"
											 +"<td>" + item.temp + "</td>"
											 +"<td>" + item.hk + "</td>"
											 +"<td>" + item.chi_tiet_hk + "</td>";
											
								addTdToTable += "</tr>";
								$("#example").append(addTdToTable);
								$("#" + item.mssv).on('click', function(){
									updateRow(item);
								});
							});
						}
					});
					
				}
			});
		}
		
		$(document).ready(function() {
		
			$("#btnAdd").click( () => {
				createRow();
			});
			
			loadTable();
			
			
		});
	</script>
</html>